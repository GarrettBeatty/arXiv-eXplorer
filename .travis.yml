sudo: required
language: android
jdk: oraclejdk8
before_cache:
- rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
- rm -rf $HOME/.gradle/caches/*/plugin-resolution/
cache:
  directories:
  - "$HOME/.gradle/caches/"
  - "$HOME/.gradle/wrapper/"
  - "$HOME/.android/build-cache"
env:
  global:
  - ANDROID_API=26
  - ANDROID_BUILD_TOOLS=26.0.2
  - secure: "SyKNJQ3l69itJhq37ZOXquJ5kxHLWg5xIji9y07YVdMuiQgCwZ65OYkWlTS/I63NOIg+vdIOtUHrSP0eySCRdHIP4DN3jbJVT1oair1nKFybyeQwSdnA4mm95Joo3YAb8w5t0BRXwRI4slvgTmRezZdVQmM1WdJ+RSSDnJcGgfk2YeIxn5Gzi8jxfBVguWfQ4Bd1FJjRaeIWyrjxRbCYb306e3bJhVKLFPQrj5cEANO/YwkkLA60tZYGrnnkgjyavs8uQEJj3MBd7laAbiLdSapTi+NdlaQR18avWUEvYlqUHFD83SdCQgfHMcTkOzeM+H/MM74PF2nhc7dEP7JEHNhruuNdkBCEKeRqIKTXROTDcuYsEz1FivnIaaJDZbEGaJVtrzhRIgO35FCW7R4J1n3QFkOxwaVtO6uJNDMzpQM6zBR845uaz//W4tA1sF7T8/LXCuy2eY3usaxIa8ljFYZlo2mP1uYiE2o3cetIAq9oYpLtGURoBHm9f9m3jyGixJ41//a9K3vGGR//rWjJUqm1S2Lhuf5on04zoyI94hELGvaaO4xxJjyYtRvvdzEjwd6jFuwhRIzM0L4smTe0CWygOPTZ1N9MFsyJUojZAVDE+p3GpwkHv3oNFqMvyJ+mm2IPw+0MnT3RuMIeVu8M4xu25roIf+vLwQV9I71Qa64="
  - secure: "k6dyjUtZPaoF4BM0g/lj0gTkQoqyyAWtpYfsZmAAbT8zg+Qi27H0SNE3ZG1szkFdCUAYCsCBbbpOCgoGr9gZY3zE9qIRrocMzJ+CGiXFg4W0gE6GY6QMFSLpMMB49s6N4no8CPuwi046T4BVYuPSmTJHFCVyt5IH0qtwZeL79uhxLQSC1DuOdkOO/zgQOxCELjvn+16iutStFtviUmir3FvtIngbir3rtFeeTQTekErml/mN6swwaWwCLTE2lEt9qVzOc9McUTA49zX8MEPh6eD0elrTtYmt+J3OAAOmW22Yg1LpKoUEG3D6Jx4qfO6vGLuYRC/XSyz1WJQAnS9HdDRe+Pj0bPROPyBFhmb3aevOmR85f6cuPcNqBD5f05bGgBK8wEa1uZjqdvsgjwxxYPOGBJ0Kn86BHWOupEltkr2UqIBvHqyuCK+nX49GLetF9NzsqgEEQNhEA8NAnFjHKna7gQ0ljF8+OhqoxT1bdv3MF9zHB7vdsM+FfdsTI1V3F4OPcX1NPF6yIyi0ncq4tIi/DGDqhz3vvIbpNhLaJIaDiZPyuIP3iU2s4n5BN7+Q02yDZWP/QKSO9d19kWxNCiQ2HOJ/75dTHXwXspdvh7AEU1A/wiwjXnAhJYpn8ATFHY7/SbTlebiDNpdYm/aZoUc8cPOIau67rk0wcEKJHMs="
  - secure: "F/qFlhUD3adaMNQOrLolQ+ewR+DbhuIAtt9v5ZZ4S9aV8FtdyYGIpeX4mk3SIRGSqrPa8HaGuYugIxHTLNvtOZeZN0vnIBOpy5Nkqe7O/xP7TmoWI2y6PpDxKAgtJzuFfg1pyW79AJS+vThrP67BPV5wm7z30tlKgfmsj9M2p9vZyBNi0wJ7HcgNM6SPL/RGGJB5GKDDM+EuSC7vFbVFTEABuEXhBRurivB4ZXt3tLFqroEaZyKgQDlsCJvkKLP6Lo79m/l6P1NnOnj0EjKgOw7rq9n2ap8n2eNEF0ulkWWjSB0hScE3CukUOjM47KYLX0zWllA+HQMEEFcyKyWwu6SQYXj7sZkyUAUt4XsDMZ7Xx8a/l5+uIa5OAPBC2fY4mYHbpgJK554YyXkoRhCF+hxSkEf2Qn7ye24K5UJ4EYjgfgai3s1TSkrZ0Bb1QSHkIQiQhIHxXhdY2A14ZEo55mY6jIoXL9MdwNQiVI7ac89y0gHqLGMTd8t7kU7854PplA80hr3wNXy3FXb/wdPL5KCTS+zlCxKFjDk1MwOfMkJPWyHXf2LhEsWtJLLbcSJFW9FI66VJloAvpPF/PnbR/+N02SlGJIBvehvF7uhrPKFTMSoU0W5blZ+Te3n/JWuoJRY3lmSQoBM0TKiaTY5s5zTg+io2rhb1hbZAhD7FoI8="

android:
  components:
  - tools
  - tools
  - platform-tools
  - android-${ANDROID_API}
  - build-tools-${ANDROID_BUILD_TOOLS}
  - extra
script:
- "./gradlew clean test build"

before_deploy:
- openssl aes-256-cbc -K $encrypted_77bee7102036_key -iv $encrypted_77bee7102036_iv -in keystore.jks.enc -out keystore.jks -d
- cd app/build/outputs/apk/release
- jarsigner -verbose -sigalg SHA1withRSA -digestalg SHA1 -keystore ${TRAVIS_BUILD_DIR}/keystore.jks
  -storepass $storepass -keypass $keypass app-release-unsigned.apk arxivexplorer
- jarsigner -verify app-release-unsigned.apk
- "${ANDROID_HOME}/build-tools/${ANDROID_BUILD_TOOLS}/zipalign -v 4 app-release-unsigned.apk
  TravisAndroid.apk"
- cd -
- scripts/tag.sh

deploy:
  provider: releases
  on:
    branch: master
  api_key:
    secure: "NbWva1OVNdmP99J5lRZw2QOFfAxi7z7F/YLunpNTI+36H7PVM0bzaiGMdZwbyqdgf/HS1F5ZzTUfcGEDsWM6A9AlGApYHpZ0lUpV4ip4LZdXTanhjZsvp7WCkWlxCWztpWnOuKzEZIFCaUeaZRIvOiqyHKMbZZdfYuAVxaQQPAWS4wOg/m2na7981nvlVAA867aaACdOODk5mzfx+wM5D6zXIpngBs9Dqy2ifnmH21q49ZQ5AOuIiQberVWm2vAw2g9Oj0sar3v13nZ1hbpzIENhWRBMVKxRaKWMtU6rts6azukDQYZwS9SxBZRGM4CzQ4mP6cSt8xtkfzk7V0021XCpAhRSKfJOy++bmtiS5mAMZPnLEv0fQ2GJRDXI78bBoulJCO+n13twbS8/iPielh5ST+tQ+kb6THxn0qa4NOcDlRrzH1zBU2Z0wFtEY65B8ksCdrsnD8cUSZP/wfhPdkiIaZOST643ZNrFDhlHi7rAYKVGqhRRdDUq4rSpSjGE4tUzmpD15otGpBkn/iEidastpbhBg5bx+F/oQgeVWTxSNm0DLCqhrcxCzTSR/eAM2EhaslZQv6Vkiy2JDLoWzvuCk0TnoGbMOOca2YUG7JMIy/VujHy/AudL8fiMTEL2HSOZNtiFHUGZeF9fY1tt8fjtiBzBC2hJfsJDL7Em/OY="
  file: "app/build/outputs/apk/release/TravisAndroid.apk"
  overwrite: true
  skip_cleanup: true